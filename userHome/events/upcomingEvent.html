
<!DOCTYPE html>
<html lang = "en">
    <head>
    <title>Upcoming Events</title>
    <meta charset="utf-8"/>    
    <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>




        
        
    <script>
    // Initialize Firebase
    var config = {
    apiKey: "AIzaSyDCa_8SolFzkpl9m292jOa4Uz-GY6eMALg",
    authDomain: "comp1930project.firebaseapp.com",
    databaseURL: "https://comp1930project.firebaseio.com",
    projectId: "comp1930project",
    storageBucket: "comp1930project.appspot.com",
    messagingSenderId: "678746640473"
    };
    firebase.initializeApp(config); 
    
    var database = firebase.database();
    
    var myURL = window.location.href;
    var myUserURL = myURL.split("?");
    var userNameString = myUserURL[1].split("=");
    var myUser = userNameString[1];
    
    
 
    var ref = database.ref().child('events');
    

    
    var AllMembersArray = [];
    var isValidUser = false;
        
    var flatten = function(arr){
        var flatMap = [];
        arr.forEach(fucntion(value){
                    if(Array.isArray(value)){
            flatMap = flatMap.concat(flatten(value))
        } else {
            flatMap.push(value)
        }
    });
}
    
        
    var now = new Date().valueOf();
    
        
    ref.on('value',getData);
        function getData(data){
            var events = data.val();
            var eventsArray = Object.keys(events);
        
    for(var i = 0; i < eventsArray.length; i++){
        var k = eventsArray[i];
        var myEventName = events[k].Event_Name;
        var myDateAndTime = events[k].DateAndTime;
        var myLocation = events[k].Location;
        var myGroup = events[k].Group;
        var myDescription = events[k].Description;
        var myAttendees = events[k].AllMembers;
        AllMembersArray.push(myAttendees);
        
        
        console.log(flatten(AllMembersArray));
        
        if(AllMembersArray.includes(myUser)){
            isValidUser = true;
        }
//        for(var j = 0; j < AllMembersArray; j++){   
//            if(AllMembersArray[j].includes(myUser)){
//                isValidUser = true;
//                break;
//            } 
//        }
        
        console.log(isValidUser);
        if(Date.parse(myDateAndTime) >= now && isValidUser){
            
        var li = document.createElement('text');
        li.innerHTML = myEventName;
        var breakline = document.createElement('br');
        document.body.appendChild(breakline);
            
        document.body.appendChild(li);
        document.body.appendChild(breakline);
         


        var li2 = document.createElement('text');
        li2.innerHTML = "Location: " + myLocation;
        document.body.appendChild(li2);
        var breakline = document.createElement('br');
        document.body.appendChild(breakline);
        
        var li3 = document.createElement('text');
        li3.innerHTML = "Group(s): " + myGroup;
        document.body.appendChild(li3);
        var breakline = document.createElement('br');
        document.body.appendChild(breakline);

        var li4 = document.createElement('text');
        li4.innerHTML = "Date and Time: " + myDateAndTime;
        document.body.appendChild(li4);
        var breakline = document.createElement('br');
        document.body.appendChild(breakline);

        var li5 = document.createElement('text');
        li5.innerHTML = "Desciptions: " + myDescription;
        document.body.appendChild(li5);
        var breakline = document.createElement('br');
        document.body.appendChild(breakline);

        var li6 = document.createElement('text');
        li6.innerHTML = "Attendees: " + myAttendees;
        document.body.appendChild(li6);
        var breakline = document.createElement('br');
        document.body.appendChild(breakline);
            
    }
}


        

    }
  
        
    function errEvent(err){
        alert("Error!");
        
    }
    
    </script>    
    <style>
      @import url('https://fonts.googleapis.com/css?family=Abril+Fatface');
       
     
    
      body {
	    background-color: #CFE0E8;
        color: #667292;
	    width: 100%;
		height: 100%;
        overflow-x: hidden;
	  }
        
      #text {
        text-align: center;
        color: #667292;
        font-size: 60pt;
        margin-top: 0.5em;
        font-weight: 900;
        font-family: 'Abril Fatface', cursive;
        letter-spacing: 3px;
      }
        
    </style>
    </head>
    <body>
    <header>
      <h1 id="text">Upcoming Events</h1>
    </header>
    </body>
</html>
