
<!DOCTYPE html>
<html lang = "en">
    <head>
    <title>Upcoming Events</title>
    <meta charset="utf-8"/>    
    <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
    <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyDCa_8SolFzkpl9m292jOa4Uz-GY6eMALg",
      authDomain: "comp1930project.firebaseapp.com",
    databaseURL: "https://comp1930project.firebaseio.com",
    projectId: "comp1930project",
    storageBucket: "comp1930project.appspot.com",
    messagingSenderId: "678746640473"
    };
    firebase.initializeApp(config); 
    
    var database = firebase.database();
    
    var myURL = window.location.href;
    var myUserURL = myURL.split("?");
    var userNameString = myUserURL[1].split("=");
    var myUser = userNameString[1];
    
    
 
    var ref = database.ref().child('events');
    var isValidUser = false;
        
    ref.on('value', function(snap){
        snap.forEach(function(snapChild){
            myMemberList = snapChild.val().AllMembers;
            for(var i = 0; i < myMemberList.length; i++){
                if (myMemberList[i].includes(myUser)){
                    isValidUser = true;
                }
            }
        })
    })
    
    ref.on('value', getEvent, errEvent);
    
    var now = new Date().valueOf();
    console.log(now);     
        
    function getEvent(event){
    var events = event.val();
    var eventsArray = Object.keys(events);
    console.log(eventsArray);
    
       
    for(var i = 0; i < eventsArray.length; i++){
        var k = eventsArray[i];
        var myEventName = events[k].Event_Name;
        var myDateAndTime = events[k].DateAndTime;
        console.log(myEventName);
        
        console.log(isValidUser);
        var li = document.createElement('div');
        li.innerHTML = myEventName;
        console.log(li);
        if((Date.parse(myDateAndTime) >= now) && isValidUser){
        document.body.appendChild(li);  
    }
}

    var btn = document.createElement("input");
    btn.setAttribute("type", "button" );
    btn.setAttribute("value", "Go Vote!");
    btn.setAttribute('id', "myBtn");
    document.body.appendChild(btn);
        
        btn.onclick = function(){
      var myURL = window.location.href;
      var myUserURL = myURL.split("?");
      var userNameString = myUserURL[1].split("=");
      var myUser = userNameString[1];
      window.location.href = "./vote.html?username=" + myUser ;
    }
    }
  
        
    function errEvent(err){
        alert("Error!");
        
    }
    
    </script>    
    <style>
      @import url('https://fonts.googleapis.com/css?family=Abril+Fatface');
        
      body {
	    background-color: #1F2833;
        color: #66FCF1;
	    width: 100%;
		height: 100%;
        overflow-x: hidden;
	  }
        
      #text {
        text-align: center;
        color: #66FCF1;
        font-size: 5em;
        margin-top: 0.5em;
        font-weight: 900;
        font-family: 'Abril Fatface', cursive;
        letter-spacing: 7px;
      }
        
    </style>
    </head>
    <body>
    <header>
      <h1 id="text">Upcoming Events</h1>
    </header>
    </body>
</html>
